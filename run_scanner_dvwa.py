from colorama import Fore, Style

from handlers.write_target import Writer
from vulnerability_scanner import Scanner

TARGET_LINKS_TO_WRITE = "LINKS_success"


class ScanningLevels:
    EASY = "easy"  # Scans until the first payload found
    HARD = "hard"  # Scan for all payloads


class Case:
    XSS_IN_LINK = "xss_in_link"
    XSS_IN_FORM = "xss_in_form"
    XSS_IN_HEADER = "xss_in_header"
    COMMAND_IN_LINK = "command_in_link"
    COMMAND_IN_FORM = "command_in_form"
    HTML = "html"
    SQL = "sql"
    CSRF = "csrf"


def run_scaner(case, scanning_levels, requests_per_minute=None):
    vulnerability_scanner = Scanner(TARGET_URL, LINKS_TO_IGNORE)
    vulnerability_scanner.login(LOGIN_URL, AUTHORIZATION_IN_LOGIN_FORM)
    # vulnerability_scanner.login_with_cookie(LOGIN_URL, AUTHORIZATION_IN_COOKIE)

    print(f"{Fore.GREEN}{Style.BRIGHT}\nCrawler Starts ðŸ§ ==>{Style.RESET_ALL}\n")
    vulnerability_scanner.crawl()
    vulnerability_scanner.write_target_links(TARGET_LINKS_TO_WRITE)

    print(f"{Fore.GREEN}{Style.BRIGHT}\nVulnerability Scanner Starts ðŸ§ ==> {Style.RESET_ALL}\n")
    vulnerability_scanner.run_scanner(case, scanning_levels, requests_per_minute)

    vulnerability_scanner.requests_per_minute()

    all_lists = vulnerability_scanner.get_all_lists()
    writer = Writer(all_lists)
    writer.write_target_success()


if __name__ == '__main__':
    TARGET_URL = "http://192.168.11.129/dvwa/"
    LOGIN_URL = f"{TARGET_URL}/login.php"

    LINKS_TO_IGNORE = [
        'http://192.168.11.129/dvwa/logout.php',

        "http://192.168.11.129/dvwa/dvwa/css/main.css",
        # "http://192.168.11.129/dvwa/vulnerabilities/brute/",
        "http://192.168.11.129/dvwa/favicon.ico",
        # "http://192.168.11.129/dvwa/",
        "http://192.168.11.129/dvwa/instructions.php",
        "http://192.168.11.129/dvwa/setup.php",
        # "http://192.168.11.129/dvwa/vulnerabilities/exec/",
        # "http://192.168.11.129/dvwa/vulnerabilities/csrf/",
        # "http://192.168.11.129/dvwa/vulnerabilities/fi/?page=include.php",
        # "http://192.168.11.129/dvwa/vulnerabilities/sqli/",
        "http://192.168.11.129/dvwa/vulnerabilities/sqli_blind/",
        # "http://192.168.11.129/dvwa/vulnerabilities/upload/",
        # "http://192.168.11.129/dvwa/vulnerabilities/xss_r/",
        # "http://192.168.11.129/dvwa/vulnerabilities/xss_s/",
        # "http://192.168.11.129/dvwa/security.php",
        "http://192.168.11.129/dvwa/phpinfo.php",
        "http://192.168.11.129/dvwa/phpinfo.php?=PHPB8B5F2A0-3C92-11d3-A3A9-4C7B08C10000",
        # "http://192.168.11.129/dvwa/about.php",
        "http://192.168.11.129/dvwa/instructions.php?doc=PHPIDS-license",
        "http://192.168.11.129/dvwa/instructions.php?doc=readme",
        "http://192.168.11.129/dvwa/instructions.php?doc=changelog",
        "http://192.168.11.129/dvwa/instructions.php?doc=copying",
        # "http://192.168.11.129/dvwa/security.php?phpids=on",
        # "http://192.168.11.129/dvwa/security.php?phpids=off",
        # "http://192.168.11.129/dvwa/security.php?test=%22><script>eval(window.name)</script>",
        "http://192.168.11.129/dvwa/ids_log.php",

    ]

    print(f"{Fore.RED}{Style.BRIGHT}ðŸ§ LINKS_TO_IGNORE: {Style.RESET_ALL}{LINKS_TO_IGNORE}\n")

    AUTHORIZATION_IN_LOGIN_FORM = {
        "username": 'admin',
        "password": 'password',
        "Login": 'submit',
    }

    REQUESTS_PER_MINUTE = 60  # def run_scaner --> requests_per_minute=None

    run_scaner([
        Case.XSS_IN_LINK,
        Case.XSS_IN_FORM,
        Case.XSS_IN_HEADER,
        Case.COMMAND_IN_LINK,
        Case.COMMAND_IN_FORM,
        # Case.HTML,
        # Case.SQL,
        Case.CSRF,
    ],
        ScanningLevels.EASY)  # add REQUESTS_PER_MINUTE
